{% comment %}
  Renders cart drawer

  Usage:
  {% render 'cart-drawer' %}
{% endcomment %}

<script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'cart-drawer.js' | asset_url }}" defer="defer"></script>

<style>
  .drawer {
    visibility: hidden;
  }
</style>
{%-assign perProd = all_products['product-personalization'] -%}
{%-assign perProdPrice = perProd.price -%}
<cart-drawer class="group/drawer drawer{% if cart == empty %} is-empty{% endif %} z-[9999999999]  [&.active]:visible fixed w-full h-full top-0 right-0">
  <div
    id="CartDrawer"
    class="cart-drawer h-full flex justify-end opacity-0 transition-opacity group-[.active]/drawer:opacity-100"
  >
    <div
      id="CartDrawer-Overlay"
      class="cart-drawer__overlay absolute w-full h-full bg-black/50 "
    ></div>
    <div
      class="drawer__inner group/overflow  js-overflow-styled bg-white h-full w-full md:max-w-[500px] translate-x-full group-[.active]/drawer:translate-x-0 duration-500 flex flex-col"
      role="dialog"
      aria-modal="true"
      aria-label="{{ 'sections.cart.title' | t }}"
      tabindex="-1"
    >
      {%- if cart == empty -%}
        <div class="drawer__inner-empty py-24 lg:py-16 px-10 lg:px-28 flex-1 flex justify-center items-center">
          <div class="cart-drawer__warnings center{% if settings.cart_drawer_collection != blank %} cart-drawer__warnings--has-collection{% endif %}">
            <div class="cart-drawer__empty-content">
              <div class="space-y-4 lg:space-y-6">
                <h2 class="cart__empty-text  m-h1 lg:d-h1">{{ 'sections.cart.empty' | t }}</h2>
                <button
                  onclick="this.closest('cart-drawer').close()"
                  class="btn-large btn-primary"
                >
                  {{ 'general.continue_shopping' | t }}
                </button>

                {%-if settings.cart_quiz_1_link != blank
                  or settings.cart_quiz_2_link != blank
                  or settings.cart_quiz_1_title != blank
                  or settings.cart_quiz_2_title != blank
                -%}
                  <div class="space-y-3 lg:space-y-4">
                    <h2 class="cart__empty-text  m-h2 lg:d-h2">{{ settings.quiz_btns_title }}</h2>
                    <div class="flex gap-2">
                      {%- if settings.cart_quiz_1_title != blank and settings.cart_quiz_1_link != blank -%}
                        <a
                          href="{{ settings.cart_quiz_1_link }}"
                          class="btn-large btn-primary overflow-visible"
                        >
                          {{ settings.cart_quiz_1_title }}
                        </a>
                      {%- endif -%}
                      {%- if settings.cart_quiz_2_title != blank and settings.cart_quiz_2_link != blank -%}
                        <a
                          href="{{ settings.cart_quiz_2_link }}"
                          class="btn-large btn-primary overflow-visible"
                        >
                          {{ settings.cart_quiz_2_title }}
                        </a>
                      {%- endif -%}
                    </div>
                  </div>
                {%- endif -%}

                {%- if shop.customer_accounts_enabled and customer == null -%}
                  <p class="cart__login-title h3">{{ 'sections.cart.login.title' | t }}</p>
                  <p class="cart__login-paragraph">
                    <a class="btn-tertiary" href="{{routes.account_login_url}}">Login</a> to checkout faster
                  </p>
                {%- endif -%}
              </div>
              <button
                class="drawer__close fixed cursor-pointer top-10 lg:top-14 right-10 lg:right-14 z-[60] w-[12px] h-[12px] lg:w-[16px] lg:h-[16px] [&_svg]:w-full [&_svg]:h-auto  close-icon"
                type="button"
                onclick="this.closest('cart-drawer').close()"
                aria-label="{{ 'accessibility.close' | t }}"
              >
                {%- render 'icon-close' -%}
              </button>
            </div>
          </div>
        </div>
      {%- endif -%}

      <div class="cart-inner-scrolled overflow-auto js-overflow-wrap overscroll-contain pt-6 !pb-0 px-4 lg:px-4 flex-1 {% if cart == empty %}hidden {% endif %}">
        <div class="drawer__header flex justify-between pb-6 items-center">
          <div class="lg:w-20 lg:w-[80px] h-6">
            <button
              class="drawer__close cursor-pointer left-0 lg:left-0 z-[60] w-[24px] h-[24px] [&_svg]:w-full [&_svg]:h-auto close-icon"
              type="button"
              onclick="this.closest('cart-drawer').close()"
              aria-label="{{ 'accessibility.close' | t }}"
              style="transform: rotate(180deg);"
            >
              {%- render 'icon-arrow-long' -%}
            </button>
          </div>

          <div class="flex ">
            <div class="drawer__center ml-auto space-y-4 lg:space-y-6">
              <h2 class="drawer__heading text-base">Shopping Bag</h2>

              {%- liquid
                assign has_intro_copy = false
                assign points_per_pound = settings.points_per_pound
                assign cart_drawer_intro_loggedin = settings.cart_drawer_intro_loggedin
                assign cart_drawer_intro_loggedout = settings.cart_drawer_intro_loggedout

                if points_per_pound
                  assign calc_points = cart.total_price | divided_by: 100 | times: points_per_pound
                endif
              -%}

              {%- if customer and points_per_pound and cart_drawer_intro_loggedin -%}
                {%- assign has_intro_copy = true -%}
                {%- assign intro_replaced = cart_drawer_intro_loggedin | replace: '{points}', calc_points -%}
                {% comment %}<div class="wysiwyg">{{ intro_replaced }}</div>{% endcomment %}
              {%- elsif points_per_pound and cart_drawer_intro_loggedout -%}
                {%- assign has_intro_copy = true -%}
                {%- assign intro_replaced = cart_drawer_intro_loggedout | replace: '{points}', calc_points -%}
                {% comment %}<div class="wysiwyg">{{ intro_replaced }}</div>{% endcomment %}
              {%- endif -%}

              {%- if has_intro_copy == false -%}
                {% comment %}<div class="wysiwyg">{{ settings.cart_drawer_intro }}</div>{% endcomment %}
              {%- endif -%}
            </div>
          </div>
          <p class="drawer__count text-[12px] leading-6 lg:w-20 lg:w-[80px]">
            {%- assign excluded_handles = '' -%}
          
            {%- if settings.product_samples != blank -%}
              {%- for sample_product in settings.product_samples -%}
                {%- assign handle = sample_product.handle -%}
                {%- if excluded_handles == '' -%}
                  {%- assign excluded_handles = handle -%}
                {%- else -%}
                  {%- assign excluded_handles = excluded_handles | append: ',' | append: handle -%}
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}
          
            {%- assign excluded_handles = excluded_handles | append: ',product-personalization' | split: ',' -%}
          
            {%- assign adjusted_count = 0 -%}
            {%- for item in cart.items -%}
              {%- if item.product.tags contains "singleton_gift" -%}
                {%- assign free_gift_available = "free-gift-available" -%}
                {%- capture free_gift -%}
                  <div class="grid grid-cols-[140px_1fr] p-4 gap-4 bg-primary-white-cotton mt-4">
                      <img
                        class="cart-item__image w-full h-full object-cover inset-0"
                        src="{{ item.image | image_url: width: 360 }}"
                        alt="{{ item.image.alt | escape }}"
                        loading="lazy"
                        width="155"
                        height="155"
                      >
                      <div class="flex flex-col">
                        <p class="cart-item__name">{{- item.product.title | escape -}}</p>
                        <div class="text-[12px] sm:grid-cols-[minmax(0,max-content)_auto] gap-2 gap-y-1 lg:gap-y-2">
                          {%- for option in item.options_with_values -%}
                            <div class="product-option flex items-baseline justify-between mt-2 flex-wrap">
                              <dt class="cart-item__attributes justify-between">
                                {%- liquid
                                  if option.name == 'color' or option.name == 'Color'
                                    echo 'Colour'
                                  else
                                    echo option.name
                                  endif
                                -%}
                                :&nbsp;
                              </dt>
                              <dd>{{ option.value -}}</dd>
                            </div>
                          {%- endfor -%}
                        </div>
                        <p class="text-sm font-semibold mt-auto ml-auto">Free</p>
                      </div>
                  </div>
                {%- endcapture -%}
              {%- endif -%}
          
              {%- unless excluded_handles contains item.product.handle -%}
                {%- assign adjusted_count = adjusted_count | plus: item.quantity -%}
              {%- endunless -%}
            {%- endfor -%}
          
            {{ adjusted_count }} product{% if adjusted_count != 1 %}s{% endif %}
          </p>
        </div>

        {%- assign free_shipping_threshold = settings.free_shipping_threshold | times: 100 -%}
        {%- assign cart_total = cart.total_price -%}

        <cart-gift-progress-bar
            data-cart-total="{{ cart_total | money_without_currency }}"
            data-currency-sign="{{ 0 | money | split: 0 | first }}"
            data-shipping-threshold="{{ free_shipping_threshold | divided_by: 100 }}"
            {%- unless free_shipping_threshold > 0 -%}hidden{%- endunless -%}
        >
          <div class="drawer__shipping p-4">
            {%- assign progress_percentage = cart_total | times: 100 | divided_by: free_shipping_threshold -%}
            {%- if progress_percentage > 100 -%}
              {%- assign progress_percentage = 100 -%}
            {%- endif -%}

            <div class="mini-cart-shipping ">
                <div class="flex">
                  <p data-gift-message class="flex items-center text-sm font-normal">
                    {%- if cart_total >= free_shipping_threshold -%}
                      Congratulations! You unlocked free delivery!
                    {%- else -%}
                      You are {{ free_shipping_threshold | minus: cart_total | money }} away from free standard delivery
                    {%- endif -%}
                  </p>
                </div>

                <div data-progress-container class="progress-bar-container">
                  <div class="progress-bar {% if progress_percentage == 100 %}progress-bar--filled{% endif %}"
                       style="width: {{ progress_percentage }}%;"
                       data-progress-bar
                  ></div>

                  <div data-progress-point="delivery" style="left: 100%;"
                       class="h-[150%] aspect-square absolute-centered-y flex items-center">
                    {%- render 'icon-shipping', class: 'w-7 h-7 text-primary-blue absolute bottom-full left-0 -translate-x-1/2' -%}
                    <div data-point class="h-full w-full rounded-full border border-primary-blue {% if cart_total >= free_shipping_threshold -%}bg-primary-white-cotton{% else %}bg-primary-blue{% endif %}"></div>
                    <div class="absolute top-full left-0 -translate-x-1/2 text-center">
                      <p data-price class="font-semibold text-xs whitespace-nowrap mt-1">{{ free_shipping_threshold | money }}</p>
                      <p class="text-xs whitespace-nowrap">Free delivery</p>
                    </div>
                  </div>

                  <div data-progress-point="gift" style="left: 75%;" hidden
                       class="h-[150%] aspect-square absolute-centered-y flex items-center">
                    {%- render 'icon-gift', class: 'w-7 h-7 text-primary-blue absolute bottom-full left-0 -translate-x-1/2' -%}
                    <div data-point class="h-full w-full rounded-full bg-primary-blue border border-primary-blue"></div>
                    <div class="absolute top-full left-0 -translate-x-1/2 text-center">
                      <p data-price class="font-semibold text-xs whitespace-nowrap mt-1">{{ free_shipping_threshold | money }}</p>
                      <p class="text-xs whitespace-nowrap">Free gift</p>
                    </div>
                  </div>

                  <div data-progress-point="equal" style="left: 100%;" hidden
                       class="h-[150%] aspect-square absolute-centered-y flex items-center">
                    {%- render 'icon-shipping', class: 'w-7 h-7 text-primary-blue absolute bottom-full -left-3 -translate-x-1/2' -%}
                    {%- render 'icon-gift', class: 'w-7 h-7 text-primary-blue absolute bottom-full left-[calc(100%+12px)] -translate-x-1/2' -%}
                    <div data-point class="h-full w-full rounded-full bg-primary-blue border border-primary-blue"></div>
                    <div class="absolute top-full left-0 -translate-x-1/2 text-center">
                      <p data-price class="font-semibold text-xs whitespace-nowrap mt-1">{{ free_shipping_threshold | money }}</p>
                      <p class="text-xs whitespace-nowrap">Free delivery <br> Free gift</p>
                    </div>
                  </div>
                </div>
            </div>
          </div>
        </cart-gift-progress-bar>

        <cart-drawer-items
          {% if cart == empty %}
            class=" is-empty"
          {% endif %}
        >
          <form
            action="{{ routes.cart_url }}"
            id="CartDrawer-Form"
            class="cart__contents cart-drawer__form"
            method="post"
          >
            <div id="CartDrawer-CartItems" class="drawer__contents js-contents">
              {%- if cart != empty -%}
                <div class="drawer__cart-items-wrapper">
                  {{ free_gift }}
                  <table class="cart-items table-fixed w-full" role="table">
                    <thead class="hidden" role="rowgroup">
                      <tr role="row">
                        <th id="CartDrawer-ColumnProductImage" role="columnheader">
                          <span class="visually-hidden">{{ 'sections.cart.headings.image' | t }}</span>
                        </th>
                        <th
                          id="CartDrawer-ColumnProduct"
                          class="caption-with-letter-spacing"
                          scope="col"
                          role="columnheader"
                        >
                          {{ 'sections.cart.headings.product' | t }}
                        </th>
                        <th
                          id="CartDrawer-ColumnTotal"
                          class="right caption-with-letter-spacing"
                          scope="col"
                          role="columnheader"
                        >
                          {{ 'sections.cart.headings.total' | t }}
                        </th>
                        <th id="CartDrawer-ColumnQuantity" role="columnheader">
                          <span class="visually-hidden">{{ 'sections.cart.headings.quantity' | t }}</span>
                        </th>
                      </tr>
                    </thead>

                    <tbody role="rowgroup">
                      {%- assign giftship_subtotal = 0 -%}
                      {%- assign total_item_price = 0 -%}
                      {%- assign total_item_compare_price = 0 -%}
                      {%- assign total_items_aveings = 0 -%}
                      {%- assign personalised_product_index = 0 -%}
                      {%- assign personalised_product_key = 0 -%}
                      {%- assign personalised_product_quantity = 0 -%}
                      {%- for item in cart.items -%}
                        {%- if item.product.handle == 'product-personalization' -%}
                          {%- assign personalised_product_index = item.index | plus: 1 -%}
                          {%- assign personalised_product_quantity = item.quantity -%}
                          {%- assign personalised_product_key = item.key -%}
                        {%- endif -%}
                      {%- endfor -%}
                      {%- for item in cart.items -%}
                        {%- assign gift = item.product.tags -%}
                        {% comment %}
                          Get BundleData
                        {% endcomment %}
                        {%- assign bundleData = item.product.metafields.christyapp.bundleData.value -%}

                        {%- assign item_url = item.url -%}
                        {%- if bundleData != blank -%}
                          {%- assign item_url = item.product.url -%}
                        {%- endif -%}

                        {% comment %}
                          GIFTSHIP VARS
                        {% endcomment %}

                        {%- assign is_personalized = false -%}
                        {%- for property in item.properties -%}
                          {%- if property.first == 'Monogram' -%}
                            {%- assign is_personalized = true -%}
                          {%- endif -%}
                        {%- endfor -%}
                        {%- assign item = line_item | default: item -%}

                        {%- assign giftship_price = item.price -%}

                        {%- if item.properties._gs_bundle_prices
                          and item.properties._gs_bundle_ids != null
                          and item.product.type != 'GIST_HIDDEN_PRODUCT'
                        -%}
                          {%- assign additionalCost = 0 -%}

                          {%- for price in item.properties._gs_bundle_prices -%}
                            {%- if price != null and price != '' -%}
                              {%- assign additionalCost = additionalCost | plus: price -%}
                            {%- endif -%}
                          {%- endfor -%}

                          {%- assign item.price = item.price | plus: additionalCost -%}

                          {%- assign giftship_price = item.price | plus: additionalCost -%}
                        {%- endif -%}

                        {%- if item.properties._gs_bundle_discount -%}
                          {%- assign giftship_price = giftship_price | minus: item.properties._gs_bundle_discount -%}
                        {%- endif -%}

                        {%- assign giftship_line_price = giftship_price | times: item.quantity -%}

                        {%- if item.properties._gs_bundle_item == 'true' -%}
                          {%- continue -%}
                        {%- endif -%}

                        {%- assign giftship_subtotal = giftship_line_price | plus: giftship_subtotal -%}

                        {% comment %}
                          END GIFTSHIP VARS
                        {% endcomment %}

                        <tr
                          id="CartDrawer-Item-{{ item.index | plus: 1 }}"
                          class="cart-item align-top cart-item-wrapper relative transform {% if bundleData != blank %} cart-item--bundle {% endif %}{% if item.product.handle == 'product-personalization' %} hidden {% endif %} {% if item.product.tags contains "singleton_gift" %} !hidden cart-item-gift {% endif %}"
                          data-variant-id="{{ item.variant.id }}"
                          role="row"
                        >
                          <td
                                  class="cart-item__media w-[157px]  border-none {% if bundleData != blank and item.item_components.size -%} align-bottom pt-4 md:pt-6 {% else %} pt-4 {% endif %} {% if item.product.tags contains "singleton_gift" %} py-4 pl-4 {% else %} pb-2 {% endif %}"
                                  role="cell"
                                  headers="CartDrawer-ColumnProductImage"
                          >
                            {% if bundleData != blank and item.item_components.size > 0 %}
                              <div
                                      class=" group/card-images inline -mb-5 lg:-mb-7 lg:w-full splide--dotted-pag space-y-5"
                              >
                                <div class="">
                                  <div class="block text-blue-1">
                                    {%- assign itemComponents = item.item_components | reverse -%}
                                    {%- for component in itemComponents -%}
                                      <div class="cart-item__link block pb-2 last:pb-0">
                                        <div class=" pt-[100%] relative">
                                          <img
                                                  class="cart-item__image absolute w-full h-full object-cover inset-0"
                                                  src="{{ component.image | image_url: width: 360 }}"
                                                  alt="{{ component.image.alt | escape }}"
                                                  loading="lazy"
                                                  width="155"
                                                  height="155"
                                          >
                                        </div>
                                      </div>
                                    {%- endfor -%}
                                  </div>
                                </div>
                              </div>
                            {%- else -%}
                              {%- if item.image -%}
                                <a
                                        href="{{ item_url }}"
                                        class="cart-item__link block  relative w-full pt-[100%]"
                                        tabindex="-1"
                                        aria-hidden="true"
                                >
                                  <img
                                          class="cart-item__image absolute w-full h-full object-cover inset-0"
                                          src="{{ item.image | image_url: width: 360 }}"
                                          alt="{{ item.image.alt | escape }}"
                                          loading="lazy"
                                          width="155"
                                          height="155"
                                  >
                                </a>
                              {%- endif -%}
                            {%- endif -%}
                          </td>

                          <td
                                  class="cart-item__details  pl-5  space-y-8 lg:space-y-10 border-none {% if bundleData != blank and item.item_components.size -%} pt-4 md:pt-6 {% else %} lg:pb-4 pb-5 py-6 lg:py-4 md:py-4 {% endif %} {% if item.product.tags contains "singleton_gift" %} pr-4 {% endif %}"
                                  role="cell"
                                  headers="CartDrawer-ColumnProduct"
                          >
                            <div class="space-y-2 overflow-visible">
                              {%- if settings.show_vendor -%}
                                <p class="caption-with-letter-spacing light">{{ item.product.vendor }}</p>
                              {%- endif -%}
                              <div class="flex justify-between {% if bundleData != null and bundleData.bundleTitle != null %}bundle-card_tittle{% endif %}">
                                <a href="{{ item_url }}" class="cart-item__name">
                                  {%- if bundleData == null and bundleData.bundleTitle == null -%}
                                    {{- item.product.title | escape -}}
                                  {%- else -%}
                                    {{- bundleData.bundleTitle | escape -}}
                                  {%- endif -%}
                                </a>

                                {%- unless gift contains "singleton_gift" -%}
                                <div class="text-right {{ hide_remove_btn }} ">

                                  <cart-remove-button
                                          id="CartDrawer-Remove-{{ item.index | plus: 1 }}"
                                          class="flex"
                                          data-index="{{ item.index | plus: 1 }}"
                                          data-item-key="{{ item.key }}"
                                          {% if is_personalized == true or item.product.handle == 'product-personalization' %}
                                            data-currentquantity="{{ item.quantity }}"
                                            data-key="{{ item.key }}"
                                            data-personalized="true"
                                            data-personalizationindex="{{ personalised_product_index }}"
                                            data-personalizationquantity="{{ personalised_product_quantity }}"
                                            data-personalizationkey="{{ personalised_product_key }}"
                                          {% endif %}
                                  >
                                    <button
                                            type="button"
                                            class=" cart-remove-button z-[60] w-6 h-6  [&_svg]:w-full [&_svg]:h-auto close-icon"
                                            aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                                    >
                                      {%- render 'icon-cart-delete' -%}
                                    </button>
                                  </cart-remove-button>
                                </div>
                                {%- endunless -%}
                              </div>
                              {%- if item.product.handle == 'product-personalization' -%}
                                <span class="text-xs">(for {{ item.quantity }})</span>
                              {%- endif -%}
                              {%- if is_personalized == true -%}
                                <div class="product-option flex items-baseline flex-wrap t">
                                  <dt class="font-semibold">Quantity:&nbsp;</dt>
                                  <dd>{{ item.quantity }}</dd>
                                </div>
                              {%- endif -%}
                              {%- if item.product.has_only_default_variant == false
                              or item.properties.size != 0
                              or item.selling_plan_allocation != null
                              -%}
                                <dl class="text-[12px] sm:grid-cols-[minmax(0,max-content)_auto] gap-2 gap-y-1 lg:gap-y-2 {% if bundleData != blank and item.item_components.size -%} !gap-y-0{% endif %}">
                                  {%- if bundleData != blank and item.item_components.size -%}
                                    {%- assign itemComponents = item.item_components | reverse -%}
                                    {%- for item in itemComponents -%}
                                      <div class="space-x-2 h-[163px]">
                                        <div class="{% if bundleData != blank and item.item_components.size -%}pt-2{% endif %}">
                                          <dt class="font-semibold">
                                            {%- if item.product.handle == bundleData.mainHandle
                                            and bundleData.mainStepBaskTitle != blank
                                            and bundleData.mainStepBaskTitle != ''
                                            -%}
                                              {{ bundleData.mainStepBaskTitle }}
                                            {%- else -%}
                                              {{ item.product.title }}
                                            {%- endif -%}
                                          </dt>
                                          <dd class="">
                                            {%- if item.variant.title != 'Default Title' -%}
                                              {%- assign attributes = item.variant.title | split: '/' -%}

                                              {%- if attributes.size > 0 -%}
                                                <div class="cart-item__attributes flex justify-between gap-x-1">
                                                  <span class="">Colour:</span>
                                                  <span class="color text-end">{{ attributes[0] | strip }}</span>
                                                </div>
                                              {%- endif -%}

                                              {%- if attributes.size > 1 -%}
                                                <div class="cart-item__attributes flex justify-between gap-x-1">
                                                  <span>Size:</span>
                                                  <span class="other-attribute text-end">{{ attributes[1] | strip }}</span>
                                                </div>
                                              {%- endif -%}
                                              {% comment %}{{ item.variant.title }}{% endcomment %}
                                            {%- endif -%}
                                          </dd>
                                          <div class="cart-item__attributes qty flex justify-between">
                                            <span class="">QTY</span>
                                            <span class="whitespace-nowrap "> {{ item.quantity }}</span>
                                          </div>
                                        </div>
                                      </div>
                                    {%- endfor -%}

                                  {%- else -%}
                                  {%- if item.product.has_only_default_variant == false -%}
                                    {%- for option in item.options_with_values -%}
                                      {%- unless option.value == 'Gift Box' -%}
                                        <div class="product-option flex items-baseline flex-wrap">
                                          <dt class="cart-item__attributes justify-between">
                                            {%- liquid
                                              if option.name == 'color' or option.name == 'Color'
                                                echo 'Colour'
                                              else
                                                echo option.name
                                              endif
                                            -%}
                                            :&nbsp;
                                          </dt>
                                          <dd>
                                            {{ option.value -}}
                                          </dd>
                                        </div>
                                      {%- endunless -%}
                                    {%- endfor -%}
                                    {%- if item.gift_card -%}
                                      {% for p in item.properties %}
                                        {%- unless p.last == blank -%}
                                          <div class="product-option flex items-baseline flex-wrap 123">
                                            <dt class="cart-item__attributes justify-between">
                                              {{- p.first -}}:&nbsp;
                                            </dt>
                                            <dd class="{%- if item.properties.Message -%}max-h-[42px] block overflow-y-auto break-words{%- endif -%}">
                                              {{- p.last -}}
                                            </dd>
                                          </div>
                                        {%- endunless -%}
                                      {% endfor %}
                                    {%- endif -%}
                                  {%- endif -%}

                                  {%- render 'giftship-cart-item-properties', item: item -%}

                                  {%- if item.properties._gift_box_for_product != blank -%}
                                    <ul>
                                      <li>
                                        <div class="product-option flex items-baseline flex-wrap md:flex-nowrap">
                                          <dt class="flex-shrink-0">For:&nbsp;</dt>
                                          <dd class="md:line-clamp-1 md:text-center">{{ item.properties._gift_box_for_product }}</dd>
                                        </div>
                                      </li>
                                      {%- if item.properties._gift_box_sender != blank -%}
                                        <li>
                                          <div class="product-option flex items-baseline flex-wrap">
                                            <dt class="flex-shrink-0">Sender:&nbsp;</dt>
                                            <dd class="line-clamp-1 break-words">{{ item.properties._gift_box_sender }}</dd>
                                          </div>
                                        </li>
                                      {%- endif -%}
                                      {%- if item.properties._gift_box_recipient != blank -%}
                                        <li>
                                          <div class="product-option flex items-baseline flex-wrap">
                                            <dt class="flex-shrink-0">Recipient:&nbsp;</dt>
                                            <dd class="line-clamp-1 break-words">{{ item.properties._gift_box_recipient }}</dd>
                                          </div>
                                        </li>
                                      {%- endif -%}
                                      {%- if item.properties._gift_box_message != blank -%}
                                        <li>
                                          <div class="product-option flex items-baseline flex-wrap">
                                            <dt class="flex-shrink-0">Message:&nbsp;</dt>
                                            <dd class="max-h-[42px] block overflow-y-auto break-words">{{ item.properties._gift_box_message }}</dd>
                                          </div>
                                        </li>
                                      {%- endif -%}
                                    </ul>
                                  {%- endif -%}

                                  {%- if is_personalized == true -%}
                                    <div class="group/acc overflow-hidden mt-1 product-option-personalization ">
                                      <div data-acc class="title p-2 flex justify-between items-center xl:cursor-pointer">
                                        <a class="flex font-semibold text-[14px] items-center">
                                          <span class="mr-2">{%- render 'icon-cart-personalization' -%}</span>
                                          Personalisation
                                        </a>
                                        <span
                                            class="icon icon-error w-3 md:w-4 shrink-0 mr-1 md:mr-3 items-center group-[.open]/acc:rotate-90">
                                          {%- render 'icon-arrow-drop-down' -%}
                                        </span>
                                      </div>

                                      <div
                                          class="hidden group-[.open]/acc:!flex group-[.open]/acc:opacity-100
              opacity-0 transition-opacity delay-[0.5s] content content-max-height content-padding-s duration-300">
                                        <div class="p-2 w-[100%]">
                                          {%- for property in item.properties -%}
                                            {%- assign property_first_char = property.first | slice: 0 -%}
                                            {%- if property.first == 'Monogram' -%}
                                              {%- assign is_personalized = true -%}
                                            {%- endif -%}
                                            {%- if property.last != blank and property_first_char != '_' -%}
                                              <div class="product-option flex items-baseline flex-wrap">
                                                <dt class="font-semibold">{{ property.first }}:&nbsp;</dt>
                                                <dd>
                                                  {%- if property.last contains '/uploads/' -%}
                                                    <a
                                                        href="{{ property.last }}"
                                                        class="link"
                                                        target="_blank"
                                                        aria-describedby="a11y-new-window-message"
                                                    >
                                                      {{ property.last | split: '/' | last }}
                                                    </a>
                                                  {%- else -%}
                                                    {{ property.last }}
                                                  {%- endif -%}
                                                </dd>
                                              </div>
                                            {%- endif -%}
                                          {%- endfor -%}
                                        </div>
                                      </div>
                                    </div>
                                  {%- endif -%}

                                {%- endif -%}
                                </dl>

                                <p class="product-option">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                              {%- endif -%}

                              <ul
                                      class="discounts list-unstyled"
                                      role="list"
                                      aria-label="{{ 'customer.order.discount' | t }}"
                              >
                                {%- for discount in item.discounts -%}
                                  <li class="discounts__discount flex font-normal text-[12px]">
                                    <span class="w-3 mr-1 self-center">
                                      {%- render 'icon-discount' -%}
                                    </span>
                                    {{ discount.title }}
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </div>

                            {%- assign hide_quantity = '' -%}
                            {%- if item.product.handle == 'product-personalization' or is_personalized == true -%}
                              {%- assign hide_quantity = 'hidden' -%}
                            {%- endif -%}
                            <div
                                    id="CartDrawer-LineItemError-{{ item.key }}"
                                    class="cart-item__error flex flex-row-reverse justify-end"
                                    role="alert"
                            >
                              <small class="cart-item__error-text [&:empty+svg]:hidden"></small>
                              <svg
                                      aria-hidden="true"
                                      focusable="false"
                                      class="icon icon-error w-[24px] shrink-0 self-start mr-3"
                                      viewBox="0 0 13 13"
                              >
                                <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2" />
                                <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7" />
                                <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z"
                                      fill="white" />
                                <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z"
                                      fill="white" stroke="#EB001B" stroke-width="0.7">
                              </svg>
                            </div>
                            {%- if item.product.tags contains "singleton_gift" -%}
                            <div class="cart-item-gift-price">

                              {%- assign item_price = item.variant.price -%}
                              {%- if item_price == 0 -%}
                                <p class="text-right font-semibold text-[14px]">Free</p>
                              {%- endif -%}
                            </div>
                            {%- endif -%}
                          </td>
                        </tr>

                      {%- unless gift contains "singleton_gift" -%}
                      <tr class="cart-item align-middle border-blue-1/10 border-b {% if item.product.handle == 'product-personalization' %} hidden {% endif %}">
                        <td class="pb-4  border-b border-blue-1/10 border-none">
                          {%- if hide_quantity != 'hidden' -%}
                          <quantity-input
                                  class="quantity {{ hide_quantity }} cart-quantity space-x-3 lg:space-x-4 flex items-center [&_>*]:w-[24px] [&_>*]:h-[24px] [&_>*]:lg:w-[28px] [&_>*]:lg:h-[28px]">
                            <button
                                    class="quantity__button flex justify-center items-center no-js-hidden"
                                    name="minus"
                                    {% if is_personalized == true %}
                                      data-personalized="true"
                                    {% endif %}
                                    {% if item.product.handle == 'product-personalization' %}
                                      data-is-personalization-product-minus="true"
                                    {% endif %}
                                    type="button"
                            >
                                  <span class="visually-hidden">
                                    {{-
                                    'products.product.quantity.decrease'
                                    | t: product: item.product.title
                                    | escape
                                    -}}
                                  </span>
                              {%- render 'icon-minus' -%}
                            </button>

                            <input
                                    class="quantity__input  outline-none text-center text-[14px]"
                                    type="number"
                                    {% if item.product.handle == 'product-personalization' %}
                                      data-is-personalization-product-input="true"
                                    {% endif %}
                                    data-quantity-variant-id="{{ item.variant.id }}"
                                    name="updates[]"
                                    value="{{ item.quantity }}"
                                    data-cart-quantity="{{ cart | item_count_for_variant: item.variant.id }}"
                                    min="1"
                                    {% if item.variant.quantity_rule.max != null %}
                                      max="{{ item.variant.quantity_rule.max }}"
                                    {% endif %}
                                    step="{{ item.variant.quantity_rule.increment }}"
                                    aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                                    id="Drawer-quantity-{{ item.key }}"
                                    data-item-key="{{ item.key }}"
                                    data-index="{{ item.index | plus: 1 }}"
                                    {% if is_personalized == true %}
                                      disabled="true"
                                    {% endif %}
                            >

                            <button
                                    class="quantity__button flex justify-center items-center no-js-hidden"
                                    name="plus"
                                    type="button"
                                    {% if item.product.handle == 'product-personalization' %}
                                      data-is-personalization-product-plus="true"
                                    {% endif %}
                                    {% if is_personalized == true %}
                                      data-personalized="true"
                                    {% endif %}
                            >
                                  <span class="visually-hidden">
                                    {{-
                                    'products.product.quantity.increase'
                                    | t: product: item.product.title
                                    | escape
                                    -}}
                                  </span>
                              {%- render 'icon-plus' -%}
                            </button>
                            </quantity-input>
                            {%- endif -%}
                        </td>
                        <td
                                class="cart-item__totals w-[0%] text-right pb-4 border-none"
                                role="cell"
                                headers="CartDrawer-ColumnTotal"
                        >
                          <div class="cart-item__price-wrapper {% if is_personalized %} pl-5 {% endif %}">
                              <span class="price price--end flex justify-items-end flex-row-reverse items-end">
                                {%- assign percentoff = blank -%}
                                {%- assign is_product_bundle = false -%}

                                {%- if item.variant.metafields.christy23.bundled_product_variants != blank -%}
                                  {%- assign is_product_bundle = true -%}
                                {%- endif -%}

                                {%- assign item_compare_price = item.variant.compare_at_price -%}
                                {%- assign item_compare_price_line = item.variant.compare_at_price
                                        | times: item.quantity
                                -%}
                                {%- assign item_price = item.variant.price -%}
                                {%- assign item_price_line = item.variant.price | times: item.quantity -%}

                                {% comment %}
                                  If item has bundledata meta and has item components
                                {% endcomment %}
                                {%- if bundleData != blank and item.item_components.size > 0 -%}
                                  {%- assign is_product_bundle = true -%}
                                  {%- assign item_compare_price = 0 -%}
                                  {%- assign item_price = 0 -%}
                                  {%- for item_component in item.item_components -%}
                                    {%- assign this_compare = 0 -%}
                                    {%- if item_component.variant.compare_at_price > item_component.variant.price -%}
                                      {%- assign this_compare = item_component.variant.compare_at_price -%}
                                    {%- else -%}
                                      {%- assign this_compare = item_component.variant.price -%}
                                    {%- endif -%}

                                    {%- assign this_price = item_component.variant.price
                                            | times: item_component.quantity
                                    -%}
                                    {%- assign item_price = item_price | plus: this_price -%}
                                    {%- assign this_compare = this_compare | times: item_component.quantity -%}
                                    {%- assign item_compare_price = item_compare_price | plus: this_compare -%}
                                  {%- endfor -%}

                                  {%- if item_compare_price > item_price -%}
                                    {%- assign percentoff = item_price
                                            | times: 100.0
                                            | divided_by: item_compare_price
                                            | money_without_currency
                                            | times: 100.0
                                            | replace: '.0', ''
                                    -%}

                                    {%- assign percentoff = 100 | minus: percentoff -%}
                                  {%- endif -%}

                                  {% comment %}
                                    apply bundle discount
                                  {% endcomment %}

                                  {%- if bundleData.bundleDiscount > 0 -%}
                                    {%- assign diff = item_price | times: bundleData.bundleDiscount | divided_by: 100 -%}
                                    {%- assign item_price = item_price | minus: diff -%}
                                  {%- endif -%}

                                  {%- assign item_price_line = item_price -%}
                                  {%- assign item_compare_price_line = item_compare_price -%}
                                {%- endif -%}

                                {%- if is_personalized -%}
                                  <ul class="text-xs space-y-1  w-full relative">
                                    <li class="flex justify-between items-center">
                                      Price:
                                      <span>
                                        {%- if item_compare_price > item_price -%}
                                          <span class="price--end-sale text-[11px] lg:text-[11px] line-through mr-1">
                                            {{- item_compare_price | money -}}
                                          </span>
                                        {%- endif -%}
                                        <span class="font-semibold text-sm">{{ item_price | money }}</span>
                                      </span>
                                    </li>
                                    <li class="flex justify-between items-center">
                                      Personalisation: <span class="font-semibold text-sm">{{ perProdPrice | money }}</span>
                                    </li>
                                    <li class="flex justify-between items-center font-semibold text-sm">

                                      {%- assign percentoff = item_compare_price
                                              | minus: item_price
                                              | times: 100.0
                                              | divided_by: item_compare_price
                                              | money_without_currency
                                              | times: 100
                                              | replace: '.0', ''
                                      -%}

                                      {%- assign totalCompareMoney = item_compare_price | money_without_currency -%}
                                      {%- assign totalPriceMonry = item_price | money_without_currency -%}

                                      {%- assign priceDiff = totalCompareMoney | minus: totalPriceMonry -%}
                                      {%- assign myDis = priceDiff | divided_by: totalCompareMoney | times: 100 | round: 2 -%}
                                        {%- if percentoff != blank and myDis > 0  -%}
                                          <span class="flex cart-item__price-sale max-h-[24px] px-3 flex-row-reverse items-center gap-2 whitespace-nowrap color-background-1 absolute bottom-0 left-[-98px]">
                                            <strong>{{ percentoff }}% off </strong>
                                          </span>
                                        {%- endif -%}
                                      <div class=" w-[100%] flex justify-between items-center font-semibold text-sm">
                                      Summary: <span class="font-semibold text-sm">{{ item_price | plus: perProdPrice | money }}</span>
                                      </div>
                                    </li>
                                  </ul>

                                {%- elsif item_compare_price > item_price -%}

                                  <span class="flex gap-x-2 items-center text-[14px] lg:text-[14px] font-semibold justify-end max-lg:flex-wrap max-sm:ml-2 max-sm:flex-col">
                                      <span class="price--end-sale text-[11px] lg:text-[11px] line-through ">
                                        {{- item_compare_price | money -}}
                                      </span>
                                      <span>{{ item_price | money }} </span>
                                    </span>

                                  {%- if bundleData == blank -%}
                                    {%- assign percentoff = item_compare_price
                                        | minus: item_price
                                        | times: 100.0
                                        | divided_by: item_compare_price
                                        | money_without_currency
                                        | times: 100
                                        | replace: '.0', ''
                                    -%}
                                  {%- endif -%}

                                {%- else -%}
                                  <span class="text-sm font-semibold">
                                    {{ item_price | money }}
                                  </span>
                                {%- endif -%}

                                {%- if is_product_bundle -%}
                                  {%- assign totalCompareMoney = item_compare_price | money_without_currency -%}
                                  {%- assign totalPriceMonry = item_price | money_without_currency -%}

                                  {%- assign priceDiff = totalCompareMoney | minus: totalPriceMonry -%}
                                  {%- assign myDis = priceDiff | divided_by: totalCompareMoney | times: 100 | round: 0 -%}
                                  <span class="flex cart-item__price-sale flex-row-reverse items-center gap-2 background-primary max-sm:max-w-20 px-2 sm:whitespace-nowrap sm:px-3 sm:mr-2">
                                    {%- if bundleData != blank and myDis > 0 -%}
                                      <strong>{{- myDis }}% off </strong>
                                    {%- else %}
                                      Bundle Savings
                                    {%- endif -%}
                                  </span>
                                {%- endif -%}

                                {%- if is_personalized != true -%}
                                  {%- if percentoff != blank and bundleData == blank -%}
                                    <span class="flex cart-item__price-sale max-h-[24px] px-3 flex-row-reverse items-center mr-2 gap-2 whitespace-nowrap color-background-1">
                                      <strong>{{ percentoff }}% off </strong>
                                    </span>
                                  {%- endif -%}
                                {%- endif -%}
                                {%- assign total_item_price = total_item_price | plus: item_price_line -%}

                                {%- if item_compare_price_line > 0 -%}
                                  {%- assign total_compare_accumulate = item_compare_price_line -%}
                                {%- else -%}
                                  {%- assign total_compare_accumulate = item_price_line -%}
                                {%- endif -%}

                                {%- assign total_item_compare_price = total_item_compare_price | plus: total_compare_accumulate -%}
                                {% comment %}{% assign item_savings = total_item_compare_price | minus: total_item_price %}{% endcomment %}
                                {% comment %}{% assign total_items_aveings = total_items_aveings | plus: item_savings  %}{% endcomment %}
                              </span>

                            {%- if item.variant.available and item.unit_price_measurement -%}
                              <div class="unit-price caption">
                                <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                                {{ item.variant.unit_price | money }}
                                <span aria-hidden="true">/</span>
                                <span class="visually-hidden"
                                >&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span
                                >
                                {%- if item.variant.unit_price_measurement.reference_value != 1 -%}
                                  {{- item.variant.unit_price_measurement.reference_value -}}
                                {%- endif -%}
                                {{ item.variant.unit_price_measurement.reference_unit }}
                              </div>
                            {%- endif -%}
                          </div>

                          <div class="loading-overlay hidden mt-5">
                            <div class="loading-overlay__spinner">
                              <svg
                                      aria-hidden="true"
                                      focusable="false"
                                      class="spinner"
                                      viewBox="0 0 66 66"
                                      xmlns="http://www.w3.org/2000/svg"
                              >
                                <circle class="path !stroke-blue-1" fill="none" stroke-width="4" cx="33" cy="33"
                                        r="30"></circle>
                              </svg>
                            </div>
                          </div>
                        </td>
                      </tr>
                      {%- endunless -%}
                      {%- assign hide_remove_btn = '' -%}
                      {%- if hide_remove_btn != 'hidden' -%}
                      {%- endif -%}
                      {%- if item.product.metafields.custom.cart_upsells.value.count > 0 -%}
                      {%- for item_upsells in item.product.metafields.custom.cart_upsells.value -%}
                      {%- if item_upsells.related_product.value -%}
                      {%- assign rel_product = item_upsells.related_product.value -%}
                      <tr>
                        <td colspan="3">
                          <div class="">
                            <div class="py-5 lg:py-8">
                              <div class="flex justify-between space-x-5">
                                <h4 class="m-h2 lg:d-h3">
                                  {{- item_upsells.catchy_title -}}
                                </h4>
                                <button onclick="upsellCloseRow(this)" type="button" aria-hidden="true">
                                  {%- render 'icon-close' -%}
                                </button>
                              </div>
                              <table class="w-full">
                                <tbody>
                                <tr class="align-top">
                                  {%- render 'cart-related', rel_product: rel_product -%}
                                </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </td>
                      </tr>
                      {%- endif -%}
                      {%- endfor -%}
                      {%- endif -%}
                      {%- endfor -%}
                    </tbody>
                  </table>
                </div>
              {%- endif -%}
              <p id="CartDrawer-LiveRegionText" class="visually-hidden" role="status"></p>
              <p id="CartDrawer-LineItemStatus" class="visually-hidden" aria-hidden="true" role="status">
                {{ 'accessibility.loading' | t }}
              </p>
            </div>
            <div id="CartDrawer-CartErrors" role="alert"></div>
          </form>
        </cart-drawer-items>

        <div class="drawer__footer-cart space-y-10 lg:space-y-6 pb-5 lg:pb-8 {% if cart == empty %}hidden {% endif %}">
          <div class="space-y-2 lg:space-y-3">
            <div class="group/acc border-b ">
              <div
                  data-acc
                  class="py-6 flex w-full justify-between items-center cursor-pointer"
              >
                <span class="font-semibold text-base tracking-[.15px]">Add Promo Code</span>
                <span
                    class="acc-toggle w-4 h-4 m-1"
                ></span>
              </div>
              <div data-promocode-container class="discount-input-wrapper-app-init hidden group-[.open]/acc:!flex group-[.open]/acc:opacity-100
              opacity-0 transition-opacity delay-[0.5s] w-full [&>*]:flex-1"></div>
            </div>

            {%- assign cumulative_rrp = total_item_compare_price -%}
            {%- assign item_price_total = total_item_price -%}        
            {%- assign order_discount = cart.total_discount | default: 0 -%}
            {%- assign item_level_savings = cumulative_rrp | minus: item_price_total -%}
            {%- assign savings = item_level_savings | plus: order_discount -%}
            {%- if savings > 0 -%}
              <div
                class="totals value flex justify-center space-x-6 p-4 bg-blue-1/10 text-blue-1 font-semibold !mt-4"
                role="status"
              >
                <p class="totals__subtotal-value flex items-center text-primary-blue">
                  YOU SAVED {{ savings | money }}
                </p>
              </div>
            {%- endif -%}
            <div class="drawer__community items-center flex text-[12px] font-normal p-4 border !mt-4 border-blue-1/10">
              <p class="ml-4 font-normal text-primary-blue">
                Join the Christy Community and earn up to 120 <span class="font-semibold">loyalty points </span>for this
                order when you check out.
              </p>
            </div>
          </div>

          {%- if settings.product_samples != blank -%}
            <div class="bg-primary-white-cotton px-5 py-9 !mt-4 mb-56">
              <h3 class="text-xl text-primary-blue font-normal font-sec mb-4 text-center">
                {{- settings.product_samples_title -}}
              </h3>
              <p class="text-center font-normal text-sm text-primary-blue mb-4 tracking-[0.25px]">
                {{- settings.product_samples_description -}}
              </p>
              <p class="text-center font-normal text-sm text-primary-blue mb-4 tracking-[0.25px]">Choose your option</p>
              <div class="my-6 flex justify-center gap-2">
                {%- assign product_sample_handles = "" -%}
                {%- for product_samples in settings.product_samples -%}
                  {%- assign product_sample_handle = product_samples.handle -%}
                  {%- if product_sample_handles == "" -%}
                    {%- assign product_sample_handles = product_sample_handle -%}
                  {%- else -%}
                    {%- assign product_sample_handles = product_sample_handles | append: "," | append: product_sample_handle -%}
                  {%- endif -%}
                  <div
                    class="product-sample cursor-pointer relative w-[150px]"
                    data-sample-description="{{ product_samples.description |  strip_html }}"
                  >
                    <input
                      type="checkbox"
                      class="hidden product-sample-checkbox"
                      value="{{ product_samples.variants.first.id }}"
                    >
                    <div class="sample-fake-checkbox absolute top-3 left-3 h-6 w-6">
                      {%- render 'icon-checkmark' -%}
                    </div>
                    <img
                      class="w-[150px] h-[150px] object-cover"
                      src="{{ product_samples.featured_image | img_url:'150x' }}"
                    >
                    <p class="text-center font-normal text-sm text-primary-blue mt-[6px] tracking-[0.25px]">
                      {{- product_samples.title -}}
                    </p>
                  </div>
                {%- endfor -%}
              </div>
              <p
                class="product-sample-description text-center font-normal text-sm text-primary-blue mb-4 tracking-[0.25px] hidden"
              ></p>
            </div>
          {%- endif -%}

          <div class="complete-look-cart mb-24 overflow-hidden">
            <h2 class="font-sec font-normal text-xl mb-6 mx-auto text-center">{{ settings.upsell_title }}</h2>

            <div
              class="splide group/splide flex flex-col-reverse gap-y-3 lg:gap-y-4 {{ class }}"
              data-splide='
                {
                  "arrows": true,
                  "pagination": false,
                  "type": "slide",
                  "autoWidth": true,
                  "gap": "20px",
                  "omitEnd": true,
                  "perPage": 1,
                  "perMove": 1
                }
              '
            >
              <!-- arrows -->
              <div
                data-splide-nav
                class="splide__arrows splide__arrows--ltr hidden group-[.is-initialized]/splide:!flex justify-center items-center"
              >
                <!-- counter -->
                <div class="text-xs">
                  <span data-splide-current-page class="data-[splide-is-last-page=true]:text-secondary-blue-200"
                    >1</span
                  >
                  /
                  <span data-splide-total-pages class="text-secondary-blue-200"></span>
                </div>

                <!-- buttons -->
                <div class="ml-auto flex items-center space-x-4 absolute right-0">
                  <button
                    class="
                      splide__arrow splide__arrow--prev disabled:!text-secondary-blue-200 transition-colors !bg-transparent
                      !static !transform-none outline-none
                    "
                    type="button"
                    aria-label="Previous slide"
                    aria-controls="splide01-track"
                  >
                    {%- render 'icon-long-arrow-right', class: '!w-6 !h-6' -%}
                  </button>

                  <button
                    class="
                      splide__arrow splide__arrow--next disabled:!text-secondary-blue-200 transition-colors
                      !bg-transparent !static !transform-none outline-none
                    "
                    type="button"
                    aria-label="Next slide"
                    aria-controls="splide01-track"
                  >
                    {%- render 'icon-long-arrow-right', class: '!w-6 !h-6' -%}
                  </button>
                </div>
              </div>

              <!-- progress bar -->
              <div data-splide-progress-bar class="space-y-3 lg:space-y-4 mt-3 lg:mt-2">
                <div class="bg-secondary-blue-100 slider-progress h-px flex items-center">
                  <div class="bg-secondary-blue-600 h-px transition-all w-0 lg:h-0.5 slider-progress-bar"></div>
                </div>
              </div>

              <!-- track -->
              <div class="splide__track max-md:!overflow-visible">
                <div class="splide__list text-blue-1">
                  {%- assign excluded_handles = product_sample_handles | split: "," -%}
                  {%- if cart.items.size > 0 -%}
                    {%- assign filtered_cart_items = "" -%}
                    {%- assign debug_list = "" -%}
                    {%- for item in cart.items -%}
                      {%- unless excluded_handles contains item.product.handle or item.product.tags contains "singleton_gift" or item.product.handle == "product-personalization" or item.product.handle == "gift-wrap-2" -%}
                        {%- assign filtered_cart_items = filtered_cart_items | append: item.product.id | append: "," -%}
                        {%- assign debug_list = debug_list | append: forloop.index0  | append: "," -%}
                      {%- else -%}
                      {%- if settings.upsell_debug == true -%}
                        <p class="excluded hidden">excluded {{ item.product.title }} ({{ item.product.handle }})</p>
                      {%- endif -%}
                      {%- endunless -%}
                    {%- endfor -%}
                    {%- assign filtered_index_array = debug_list | split: "," -%}
                    {%- assign filtered_index0 = filtered_index_array[0] | plus: 0 -%}
                    {%- assign filtered_index1 = filtered_index_array[1] | plus: 0 -%}
                    {%- assign filtered_index2 = filtered_index_array[2] | plus: 0 -%}
                    {%- assign filtered_index3 = filtered_index_array[3] | plus: 0 -%}
                    {%- assign filtered_index4 = filtered_index_array[4] | plus: 0 -%}
                    {%- assign filtered_cart_items = filtered_cart_items | split: "," -%}
                    {%- assign cart_size = filtered_cart_items.size -%}
                  
                    {%- if cart_size == 1 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index0].product, size: 5 %}
                    {%- elsif cart_size == 2 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index0].product, size: 3 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index1].product, size: 2 %}
                    {%- elsif cart_size == 3 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index0].product, size: 2 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index1].product, size: 2 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index2].product, size: 1 %}
                    {%- elsif cart_size == 4 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index0].product, size: 2 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index1].product, size: 1 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index2].product, size: 1 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index3].product, size: 1 %}
                    {%- elsif cart_size >= 5 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index0].product, size: 1 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index1].product, size: 1 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index2].product, size: 1 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index3].product, size: 1 -%}
                      {% render 'cart-recomended-product' recomended_product: cart.items[filtered_index4].product, size: 1 %}
                  {%- endif -%}
                {%- endif -%}
                </div>
              </div>
            </div>
          </div>
        </div>
        <button
            onclick="this.closest('cart-drawer').close()"
            class="btn-secondary btn-secondary-mob-default btn-medium font-normal md:hidden set relative w-full mb-6"
            role="button"
        >
          Continue Shopping
        </button>
      </div>

      <div
        class="cart-drawer__footer sticky left-0 bottom-0 w-full bg-white z-10
        group-[.has-overflow]/overflow:bg-white group-[.has-overflow]/overflow:shadow-drawer js-overflow-floated
        text-center space-y-3  p-4  {% if cart == empty %}hidden {% endif %}"
        {{ block.shopify_attributes }}
      >
        <!-- CTAs -->
        <div class="flex font-normal  justify-between text-[14px] lg:text-[14px]">
          <span>Subtotal (including VAT)</span>

          <span>
            {%- if cart.discount_applications.size > 0 or cumulative_rrp > total_item_price -%}
              <span class="price--end-sale text-sm line-through pr-2">
                {{ cumulative_rrp | money }}
              </span>
              <span class="font-semibold text-base">{{ total_item_price | minus: cart.total_discount | money }}</span>
            {%- else -%}
              <span class="font-semibold text-base">{{ total_item_price | money }}</span>
            {%- endif -%}
          </span>
        </div>
        <p class="tax-note text-left caption-large rte [&_a]:underline">
          {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
            {{ 'sections.cart.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
          {%- elsif cart.taxes_included -%}
            {{ 'sections.cart.taxes_included_but_shipping_at_checkout' | t }}
          {%- elsif shop.shipping_policy.body != blank -%}
            {{ 'sections.cart.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
          {%- else -%}
            {{ 'sections.cart.taxes_and_shipping_at_checkout' | t }}
          {%- endif -%}
        </p>

        <div class="flex justify-between gap-2 flex-col md:flex-row">
          <button
            onclick="this.closest('cart-drawer').close()"
            class="btn-tertiary btn-medium border-none font-semibold md:block hidden btn-hover-animated btn-hover-animated-secondary set relative w-full"
            role="button"
          >
            Continue Shopping
          </button>

          <button
            type="submit"
            id="CartDrawer-Checkout"
            class="cart__checkout-button btn-medium uppercase relative overflow-hidden btn-primary btn-hover-animated-primary w-full"
            name="checkout"
            form="CartDrawer-Form"
            {% if cart == empty %}
              disabled
            {% endif %}
          >
            <span>Proceed to checkout</span>
          </button>
        </div>
        <div class="font-normal"><span>30 Day Trial - Free Shipping & Returns</span></div>
      </div>
    </div>
  </div>
</cart-drawer>
<style>
  .sample-fake-checkbox {
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #d6d3e9;
    border-radius: 50%;
    background-color: white;
    color: white;
    padding: 2px;
  }
  .sample-fake-checkbox svg {
    width: 16px;
  }
  .sample-fake-checkbox.checked {
    border: 1px solid #1c355e;
    background-color: #1c355e;
    color: white;
  }
</style>
<script>
  function upsellCloseRow(el) {
    const row = el.closest('tr');
    if (row) {
      row.classList.add('transition-all', 'duration-500');
      setTimeout(function () {
        row.classList.add('-translate-y-full', 'opacity-0');

        setTimeout(function () {
          row.classList.add('hidden');
        }, 501);
      }, 10);
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    function isIE() {
      const ua = window.navigator.userAgent;
      const msie = ua.indexOf('MSIE ');
      const trident = ua.indexOf('Trident/');

      return msie > 0 || trident > 0;
    }

    if (!isIE()) return;
    const cartSubmitInput = document.createElement('input');
    cartSubmitInput.setAttribute('name', 'checkout');
    cartSubmitInput.setAttribute('type', 'hidden');
    document.querySelector('#cart').appendChild(cartSubmitInput);
    document.querySelector('#checkout').addEventListener('click', function (event) {
      document.querySelector('#cart').submit();
    });
  });
</script>
